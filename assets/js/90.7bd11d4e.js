(window.webpackJsonp=window.webpackJsonp||[]).push([[90],{742:function(t,s,a){"use strict";a.r(s);var e=a(12),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"_1-什么是csrf"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是csrf"}},[t._v("#")]),t._v(" 1. 什么是CSRF")]),t._v(" "),a("p",[t._v("​\tCSRF（Cross-site request forgery）指的是"),a("strong",[t._v("跨站请求伪造攻击")]),t._v("：攻击者诱导用户进入第三方网站，在第三方网站中，向被攻击网站发送跨站请求。如果用户在被攻击攻击网站中保存了登录状态，那么攻击者就可以利用这个登录状态，绕过后台的用户验证，冒充用户向服务器执行一些操作。")]),t._v(" "),a("blockquote",[a("p",[t._v("本质")])]),t._v(" "),a("p",[t._v("​\tCSRF攻击的本质是利用cookie会在同源请求中携带发送给服务器的特点，以此实现用户的冒充。")]),t._v(" "),a("p",[t._v("##2. 攻击流程")]),t._v(" "),a("ol",[a("li",[t._v("用户登录a.com，并保留了登录凭证（cookie）")]),t._v(" "),a("li",[t._v("黑客诱导用户访问了b.com")]),t._v(" "),a("li",[t._v("b.com向a.com发送了一个请求：a.com/act=xx...")]),t._v(" "),a("li",[t._v("a.com接收到请求后，对请求进行验证，并确认是用户的凭证，误认为是受害者自己发送的请求。")]),t._v(" "),a("li",[t._v("a.com 以受害者的名义执行了act=xx。")]),t._v(" "),a("li",[t._v("攻击完成，攻击者在受害者不知情的情况下，冒充受害者，让a.com执行了自己定义的操作")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/option-star/imgs/202204062115871.png",alt:"clipboard"}})]),t._v(" "),a("h2",{attrs:{id:"_3-攻击类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-攻击类型"}},[t._v("#")]),t._v(" 3. 攻击类型")]),t._v(" "),a("h3",{attrs:{id:"_1-get型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-get型"}},[t._v("#")]),t._v(" 1）GET型")]),t._v(" "),a("blockquote",[a("p",[t._v("概念")])]),t._v(" "),a("p",[t._v("​\t比如在网站中的一个img标签里构建一个请求，当用户打开这个网站的时候就会自动发起提交")]),t._v(" "),a("blockquote",[a("p",[t._v("实例")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("img src"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://bank.example/withdraw?amount=10000&for=hacker"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" \n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("​\t在受害者访问有这个img的页面后，浏览器会自动向http://bank.example/withdraw?account=xiaoming&amount=10000&for=hacker发出一个HTTP请求。bank.example就会收到包含受害者登录信息的一次跨域请求。")]),t._v(" "),a("h3",{attrs:{id:"_2-post型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-post型"}},[t._v("#")]),t._v(" 2）POST型")]),t._v(" "),a("blockquote",[a("p",[t._v("概念")])]),t._v(" "),a("p",[t._v("​\t比如构建一个表单，然后隐藏它，当用户进入页面时，自动提交这个表单。")]),t._v(" "),a("blockquote",[a("p",[t._v("实例")])]),t._v(" "),a("p",[t._v("通常使用一个自动提交的表单，如")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("form action"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://bank.example/withdraw"')]),t._v(" method"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("POST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("input type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hidden"')]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"account"')]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xiaoming"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("input type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hidden"')]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"amount"')]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10000"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("input type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hidden"')]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"for"')]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hacker"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("form"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("forms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("submit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" \n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("访问该页面后，表单会自动提交，相当于模拟用户完成了一次POST操作。")]),t._v(" "),a("h3",{attrs:{id:"_3-链接型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-链接型"}},[t._v("#")]),t._v(" 3）链接型")]),t._v(" "),a("p",[t._v("​\t这种类型需要用户点击连接才会触发。比如在a标签的href属性里构建一个请求，然后诱导用户点击。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("a href"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://test.com/csrf/withdraw.php?amount=1000&for=hacker"')]),t._v(" taget"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_blank"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  重磅消息！！\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("a"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("h2",{attrs:{id:"_4-特点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-特点"}},[t._v("#")]),t._v(" 4. 特点")]),t._v(" "),a("ul",[a("li",[t._v("攻击由第三方网站发起，被攻击网站无法防止攻击发生")]),t._v(" "),a("li",[t._v("不能直接窃取用户数据。（只是利用用户的登录凭证）")]),t._v(" "),a("li",[t._v("难以追踪，请求有各种方式，图片url、超链接、第三方论坛、文章等。")])]),t._v(" "),a("h2",{attrs:{id:"_5-防范"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-防范"}},[t._v("#")]),t._v(" 5. 防范")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("阻止不明外域的访问（CSRF发生在第三方域名）")]),t._v(" "),a("ul",[a("li",[t._v("同源检测")]),t._v(" "),a("li",[t._v("Samesite Cookie")])])]),t._v(" "),a("li",[a("p",[t._v("提交时要求附加本域才能获取的信息（CSRF攻击者不能获得Cookie等信息，只是使用）")]),t._v(" "),a("ul",[a("li",[t._v("CSRF Token")]),t._v(" "),a("li",[t._v("双重Cookie验证")])])])]),t._v(" "),a("h3",{attrs:{id:"_1-进行同源检测"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-进行同源检测"}},[t._v("#")]),t._v(" 1） 进行同源检测")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"title"}),a("ul",[a("li",[a("code",[t._v("referer")]),t._v(": 说明从哪个页面跳转过来的")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("referer")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://baidu.com"')]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ul",[a("li",[a("code",[t._v("Origin")]),t._v(" : 用于指明当前请求来自于哪个站点")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("Origin")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://baidu.com"')]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])])]),a("blockquote",[a("p",[t._v("概念")])]),t._v(" "),a("p",[t._v("​\t服务器可以通过解析请求头Origin、Referrer字段，确定请求的来源域。服务器通过直接阻止不可信的域名请求，达到对CSRF攻击的防御。")]),t._v(" "),a("blockquote",[a("p",[t._v("缺点")])]),t._v(" "),a("ul",[a("li",[t._v("有些情况下"),a("code",[t._v("referer")]),t._v("可以被伪造，同时还会把搜索引擎的链接也给屏蔽掉。")])]),t._v(" "),a("h3",{attrs:{id:"_2-cookie-samesite"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-cookie-samesite"}},[t._v("#")]),t._v(" 2） Cookie Samesite")]),t._v(" "),a("p",[t._v("通过设置Set-Cookie响应头的Samesite属性，用于标明该Cookie只能作为第一方的Cookie，不能作为第三方的Cookie")]),t._v(" "),a("blockquote",[a("p",[t._v("Strict值 ("),a("strong",[t._v("严格模式")]),t._v(") :  Cookie在任何情况下都不能作为第三方Cookie")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("Set"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Cookie"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" foo"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" Samesite"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Strict\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("blockquote",[a("p",[t._v("Lax值("),a("strong",[t._v("宽松模式")]),t._v(")：若请求作用是页面跳转或者打开新页面，且是个get请求，则Cookie可以作为第三方Cookie")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("Set"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Cookie"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" bar"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" Samesite"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Lax\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h3",{attrs:{id:"_3-使用-token-验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-使用-token-验证"}},[t._v("#")]),t._v(" 3） 使用 Token 验证")]),t._v(" "),a("p",[t._v("用户请求时携带Token, 服务器通过验证是否携带正确的Token,来把正常请求和攻击请求区分，来防范CSRF攻击")]),t._v(" "),a("blockquote",[a("p",[t._v("流程")])]),t._v(" "),a("ol",[a("li",[t._v("服务器通过加密算法对数据进行加密")]),t._v(" "),a("li",[t._v("用户打开页面时，将获取到的token存储到sesson中")]),t._v(" "),a("li",[t._v("页面提交的请求携带这个token")]),t._v(" "),a("li",[t._v("服务器获取到请求的token, 对token进行解密，判断该token值是否有效。")])]),t._v(" "),a("blockquote",[a("p",[t._v("缺点")])]),t._v(" "),a("p",[t._v("实现复杂，每个页面都需写入token, 后端对每个接口都需要验证，工作量巨大，可能会有遗漏。")]),t._v(" "),a("h3",{attrs:{id:"_4-双重cookie验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-双重cookie验证"}},[t._v("#")]),t._v(" 4） 双重cookie验证")]),t._v(" "),a("blockquote",[a("p",[t._v("实现流程")])]),t._v(" "),a("ol",[a("li",[t._v("用户访问网站页面时，向请求域名注入一个Cookie，内容为随机字符串")]),t._v(" "),a("li",[t._v("前端向后端发起请求时，取出cookie，并添加到URL的参数中")]),t._v(" "),a("li",[t._v("后端接口验证时，把cookie字段和url参数字段进行对比，不一致就拒绝")])]),t._v(" "),a("blockquote",[a("p",[t._v("优点")])]),t._v(" "),a("ol",[a("li",[t._v("无需使用Session， 适用面更广")]),t._v(" "),a("li",[t._v("Cookie存储在客户端中，不会给服务器带来压力")]),t._v(" "),a("li",[t._v("前后端同意拦截，不用一个一个接口增加。")])]),t._v(" "),a("blockquote",[a("p",[t._v("缺点")])]),t._v(" "),a("ol",[a("li",[t._v("Cookie增加了额外字段")]),t._v(" "),a("li",[t._v("如果有其它漏洞（XSS），攻击者可以注入Cookie,防御失效")]),t._v(" "),a("li",[t._v("难以做到子域名隔离。")])]),t._v(" "),a("h2",{attrs:{id:"_6-参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-参考"}},[t._v("#")]),t._v(" 6. 参考")]),t._v(" "),a("ol",[a("li",[a("a",{attrs:{href:"https://juejin.cn/post/6844903689702866952#heading-35",target:"_blank",rel:"noopener noreferrer"}},[a("strong",[t._v("前端安全系列之二：如何防止CSRF攻击？")]),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=r.exports}}]);