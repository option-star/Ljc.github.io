---
title: 计网05 HTTPS
date: 2022-04-11
sidebar: 'auto'
categories:
- 09计网
isShowComments: true
---

## 1. HTTPS解决了HTTP的哪些问题？

### 1. 窃听风险

> 原因

​	由于HTTP本身不具备加密功能，所以也没办法做到对通信进行加密所以只能使用明文方式发送。

> 解决

​	混合加密的方式实现了信息的**机密性**，解决了窃听的风险。

![图片](https://cdn.jsdelivr.net/gh/option-star/imgs/202204111026114.png)

### 2. 冒充风险

> 原因

​		在HTTP协议通信时，不论是谁发送过来的请求都会返回响应，因此不确认通信方。

> 解决

​		将服务器公钥放入到数字证书中，解决了冒充的风险。

在计算机里，这个权威的机构就是 CA （数字证书认证机构），将服务器公钥放在数字证书（由数字证书认证机构颁发）中，只要证书是可信的，公钥就是可信的。

![图片](https://cdn.jsdelivr.net/gh/option-star/imgs/202204111026471.jpeg)



### 3. 篡改风险

> 原因

​	由于HTTP无法保证报文的真实性，因此，请求发送后直到对方接收之前的这段时间里，请求被修改了也无法获悉。遭攻击者拦截并篡改内容的攻击称为中间人攻击。

> 解决

​	摘要算法的方式来实现完整性，它能够 生成数据独一无二的指纹，指纹用于验证数据的完整性，解决了篡改的风险。

​	在计算机里会**用哈希函数来计算出内容的哈希值**，也就是内容的「指纹」，这个**哈希值是唯一的，且无法通过哈希值推导出内容**。

![图片](https://cdn.jsdelivr.net/gh/option-star/imgs/202204111026107.png)

## 2. HTTPS的加密方式有哪些？

### 1） 共享密钥加密

![img](https://cdn.jsdelivr.net/gh/option-star/imgs/202204111045730.jpeg)

​		加密和解密同用一个密钥的方式称为共享密钥加密，也被叫做对称密钥加密。以共享密钥方式加密时必须将密钥也发给对方,可究竟怎样才能安全地转交？

### 2）公开密钥加密

![img](https://cdn.jsdelivr.net/gh/option-star/imgs/202204111046342.jpeg)

​		公开密钥加密的方式很好的解决了安全问题。公开密钥加密使用一对非对称的密钥。一把为私钥，一把为公钥，其中私钥是不能让任何人得知的，而公钥则可以随便公布。发送密文的一段，使用对方的公钥进行加密，对方接收到加密信息后，使用自己的私钥进行解密。这样就避免了发送解密的私钥，解决了对称密钥共享的安全问题。(公钥加密对称加密的密钥，私钥则进行解密)。

- **公钥加密，私钥解密**。这个目的是为了**保证内容传输的安全**，因为被公钥加密的内容，其他人是无法解密的，只有持有私钥的人，才能解密出实际的内容；
- **私钥加密，公钥解密**。这个目的是为了**保证消息不会被冒充**，因为私钥是不可泄露的，如果公钥能正常解密出私钥加密的内容，就能证明这个消息是来源于持有私钥身份的人发送的。



### 3） 混合密钥加密（HTTPS）

![img](https://cdn.jsdelivr.net/gh/option-star/imgs/202204111046299.jpeg)

​		HTTPS采用共享密钥加密和公开密钥加密的混合加密机制。在交换密钥环节，使用公开密钥加密技术，之后通信报文交换的阶段，则可以使用共享密钥加密技术。



## 3. 数字证书签发和验证流程？

![图片](https://cdn.jsdelivr.net/gh/option-star/imgs/202204111031957.png)

> CA证书签发过程

1.  CA 会把持有者的公钥、用途、颁发者、有效时间等信息打成一个包，然后对这些信息**进行 Hash 计算**，得到一个 Hash 值；

2. CA 会使用自己的**私钥将该 Hash 值加密**，生成 Certificate Signature，也就是 CA 对证书做了签名；

3. 将 Certificate Signature **添加在文件证书**上，形成数字证书；

> CA证书验证过程

- 客户端会使用**同样的 Hash 算法**获取该证书的 Hash 值 H1；
- 通常浏览器和操作系统中集成了 CA 的公钥信息，浏览器收到证书后可以使用 CA 的公钥解密 Certificate Signature 内容，**得到一个 Hash 值 H2 ；**
- **最后比较 H1 和 H2，如果值相同**，则为可信赖的证书，否则则认为证书不可信。



## 4. 证书链是什么？

​	但事实上，证书的验证过程中**还存在一个证书信任链的问题**，因为我们向 CA 申请的证书一般不是根证书签发的，而是由中间证书签发的，比如百度的证书，从下图你可以看到，证书的层级有三级：

![图片](https://cdn.jsdelivr.net/gh/option-star/imgs/202204111034677.png)



>  证书信任链验证流程

![图片](https://cdn.jsdelivr.net/gh/option-star/imgs/202204111033460.png)

> 为什么需要有中间证书？

​	**这是为了确保根证书的绝对安全性，将根证书隔离地越严格越好，不然根证书如果失守了，那么整个信任链都会有问题。**





## 5. SSL/TLS握手流程是什么？

![img](https://cdn.jsdelivr.net/gh/option-star/imgs/202204111046208.png)

### 1）ClientHello

​		首先，客户端（通常是浏览器）先向服务器发出加密通信的请求，这被叫做ClientHello请求。

-   **支持的协议版本**，比如TLS 1.0版。
-   **随机数**，稍后用于生成"对话密钥"。
-   **密码套件列表**，比如RSA公钥加密。



### 2）  SeverHello

服务器收到客户端请求后，向客户端发出回应。

-   **确认SSL/TLS协议版本**。如果浏览器不支持，则关闭加密通信
-   **随机数**。用于生产【会话密钥】条件之一
-    **确认密码套件列表**，比如RSA公钥加密。
-   **数字证书**



### 3） 客户端回应

​	客户端收到服务器的回应之后，首先通过浏览器或者操作系统中的CA公钥，确认服务器的数字证书的真实性。

​	如果证书没有问题，客户端就会**从证书中取出服务器的公钥**。然后使用它加密报文，然后向服务器发送信息：

-    **随机数（`pre-master key`）**。该随机数会被服务器公钥加密
-   **加密通信算法改变通知**，标识随后的信息都将用【会话密钥】加密通信
-   **客户端握手结束通知**：标识客户端的握手阶段已经结束。这一项同时把之前所有内容的发生的 数据做个摘要，用来供服务端校验。

​	**服务端和客户端有了这三个随机数，接着就用双方协商的加密算法，各自生成本次通信的【会话密钥】。**



### 4） 服务器回应

​		服务器收到客户端的第三个随机数pre-master key之后，通过协商的加密算法，计算出本次通信的"会话密钥"。然后向客户端响应。

-   **加密通信算法改变通知**，表示随后的信息都将用【会话密钥】加密通信
-   **服务器握手结束通知**，表示服务器的握手阶段已经结束。这一项同时也是前面发送的所有内容的hash值，用来供客户端校验。



## 6. 为什么SSL/TLS握手需要三个随机数？

​		"不管是客户端还是服务器，都需要随机数，这样生成的密钥才不会每次都一样。由于SSL协议中证书是静态的，因此十分有必要引入一种随机因素来保证协商出来的密钥的随机性。

​		对于RSA密钥交换算法来说，pre-master-key本身就是一个随机数，再加上hello消息中的随机，三个随机数通过一个密钥导出器最终导出一个对称密钥。

​		pre master的存在在于SSL协议不信任每个主机都能产生完全随机的随机数，如果随机数不随机，那么pre master secret就有可能被猜出来，那么仅适用pre master secret作为密钥就不合适了，因此必须引入新的随机因素，那么客户端和服务器加上pre master secret三个随机数一同生成的密钥就不容易被猜出了，一个伪随机可能完全不随机，可是是三个伪随机就十分接近随机了，每增加一个自由度，随机性增加的可不是一。"



## 7. HTTPS有什么缺点？

​		与纯文本通信相比，加密通信**会消耗更多的CPU和内存资源**。如果每次通信都加密，会消耗相当多的资源。在进行加密处理时，并非对所有内容都进行加密处理，而是仅在那些需要隐藏的信息才会加密，以节约资源。 



## 参考

1. [图解HTTP](https://weread.qq.com/web/reader/3da32b505dd9f43da9a1acakd8232f00235d82c8d161fb2)
2. [看完这篇 HTTPS，和面试官扯皮就没问题了](https://juejin.cn/post/6844904089495535624)
3. [《大前端进阶 安全》系列 HTTPS详解（通俗易懂）](https://juejin.cn/post/6844904127420432391)
4. [分分钟让你理解HTTPS](https://juejin.cn/post/6844903599303032845)
4. [用信鸽来解释 HTTPS](https://mp.weixin.qq.com/s?__biz=MzI4Njc5NjM1NQ==&mid=2247485207&idx=1&sn=64827cd627ad08798d21076cef1b7cfa&chksm=ebd6383bdca1b12de54dc4e157543b2ff63fc8c876a73f830d3855760b90ae109b239ade633f&mpshare=1&scene=24&srcid=0416kj0u5u9OKS1MIT61ETQM#rd)

