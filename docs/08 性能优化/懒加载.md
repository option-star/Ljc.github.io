## 1. 懒加载概念

- **定义**： 懒加载也叫延迟加载，指的是在长网页中延迟加载图片数据

- **解决的问题**： 在长网页中，如果图片较多，所有图片都加载，而用户只能看到可视化窗口的那部分，无疑浪费了性能。

- **实现原理**： 每次滚动只加载可视化窗口的数据，窗口之外的数据不会被加载

- **优点**
  - 网页加载速度加快
  - 减少服务器负载

- **适合场景**
  - 图片多
  - 长列表

## 2. 懒加载的特点

- **减少无用资源的加载**
- **提高用户体验**：如果加载较多图片，需要等待的时间较长，影响用户体验
- **防止加载过多图片而影响其他资源文件的加载**

## 3. 懒加载实现原理

:::warning

​	data-xxx中的xxx可以自由定义，这里我们使用data-src来定义。

:::

- **实现思路**
  - **前提**： 对图片进行src赋值时，浏览器会请求图片资源
  - 通过html5的data-xxx的属性存储图片的路径，在需要加载的时候，再对图片进行src赋值。
  - **重点**： 需要判断加载哪些图片，也就是当图片出现在可视化区域时，将图片真实地址赋值给图片

:::tip

- **window.innerHeight** : 浏览器可视化区的高度
- **document.body.scrollTop**: 浏览器滚动过的距离
- **document.documentElement.scrollTop**: 浏览器滚动过的距离
- **HTMLElement.offsetTop** : 元素顶部距离文档顶部的高度（包括滚动条距离）
- **图片加载条件**： imgs.offsetTop  < window.innerHeight + document.body.scrollTop  

:::

- **图示**：

![img](https://gitee.com/ljcdzh/my_pic/raw/master/img/202203200927875.webp)

- **代码实现**：

```html
<div class="container">
     <img src="loading.gif"  data-src="pic.png">
     <img src="loading.gif"  data-src="pic.png">
     <img src="loading.gif"  data-src="pic.png">
     <img src="loading.gif"  data-src="pic.png">
     <img src="loading.gif"  data-src="pic.png">
     <img src="loading.gif"  data-src="pic.png">
</div>
<script>
var imgs = document.querySelectorAll('img');
function lozyLoad(){
		var scrollTop = document.body.scrollTop || document.documentElement.scrollTop;
		var winHeight= window.innerHeight;
		for(var i=0;i < imgs.length;i++){
			if(imgs[i].offsetTop < scrollTop + winHeight ){
				imgs[i].src = imgs[i].getAttribute('data-src');
			}
		}
	}
  window.onscroll = lozyLoad();
</script>
```



## 4. 懒加载与预加载的区别

### 1) 懒加载

- **定义**：懒加载也叫延迟加载，只有当用户访问时，才去加载
- **作用**：
  - 提高网站首屏加载速度
  - 提高用户体验
  - 减少服务器压力
- **适用场景**
  - 图片多、页面长
- **实现原理**
  1. 将页面上的图片的src属性设置为空字符串
  2. 将图片的真实路径保存在一个自定义属性data-src中
  3. 当滚动时判断，如果图片进入可视化区域，再从自定义属性中取出真实路径赋值给图片的src属性



### 2）预加载

- **定义**： 将所需资源加载到本地，需要用到时就直接从缓存取资源。
- **作用**：
  - 减少用户等待的时间‘
  - 提高用户体验
- **常用实现**：
  - image对象，通过image对象来设置src属性，实现图片的预加载。

