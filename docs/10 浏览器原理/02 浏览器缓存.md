---
title: 浏览器02:浏览器缓存 
date: 2022-03-23
sidebar: 'auto'
categories:
- 10浏览器
isShowComments: true
---



## 1. 为什么使用缓存

对于一个数据请求来说，可以分为3步：

1. 浏览器发起请求
2. 后端处理
3. 后端响应

浏览器缓存可以在第一步和第三步优化性能：

- 对于第一步：直接使用缓存资源，直接**省去发送请求**，即减少服务器的负担，提高了网站的性能，加快网页的加载速度。
- 对于第三步：发起请求但后端存储的数据和缓存的数据一致，没必要将数据回传回来，这样就**减少了多余网络传输**。



## 2. 缓存位置有哪些

从缓存位置来看，各自具有优先级，当一次查找且都没有命中的时候，才会去请求网络。

1. Service Worker
2. Memory Cache
3. Disk Cache
4. Push Cache

### 1） Service Worker

​	Service Worker是运行在浏览器背后的独立线程，一般用来进行缓存。该缓存时永久性的，即关闭tab也或者浏览器下次打开依旧存在。

### 2) Memory Cache



### 3) Disk Cache

> Disk Cache

​	`Disk Cache`存储在硬盘中的缓存。`disk cache`会严格根据HTTP头信息中的各类字段来判断哪些资源可以缓存，哪些资源不可以缓存；哪些资源是仍可用的，哪些资源是过时的需要重新请求的。当命中缓存之后，浏览器会从硬盘中读取资源

> 应用场景

- 大文件
- 若当前内存使用率高，文件会优先存储进磁盘

> 特点

- 直接将缓存写入硬件磁盘
- 读取需要对硬件文件进行I/O操作，然后重新解析该缓存内容，读写复杂，速度比内存慢
- 文件类型覆盖大
- 容量大、存储事件可控



### 4） Push Cache

​	Push Cache只是会话（Session）中存在，一旦会话结束就被释放，并且缓存事件也很短暂，在Chrome浏览器只有5分钟，同时它并非严格执行HTTP头的缓存指令

> 特点：

1. 所有的资源都能被推送，并且能够被缓存,但是 Edge 和 Safari 浏览器支持相对比较差
2. 可以推送 no-cache 和 no-store 的资源 



## 3. 浏览器缓存的全过程

![业务流程图1.png](https://gitee.com/ljcdzh/my_pic/raw/master/img/202203231044451.webp)

1. 浏览器第一次加载资源，服务器返回 200，浏览器从服务器下载资源文件，并缓存资源文件与 response header，以供下次加载时对比使用；

2. 下一次加载资源时，由于强制缓存优先级较高，先比较当前时间与上一次返回 200 时的时间差，如果没有超过 **cache-control** 设置的 max-age，则没有过期，并命中强缓存，直接从本地读取资源。如果浏览器不支持HTTP1.1，则使用 **expires** 头判断是否过期；

3. 如果资源已过期，则表明强制缓存没有被命中，则开始协商缓存，向服务器发送带有 If-None-Match 和 If-Modified-Since 的请求；

4. 服务器收到请求后，优先根据 Etag 的值判断被请求的文件有没有做修改，Etag 值一致则没有修改，命中协商缓存，返回 304；如果不一致则有改动，直接返回新的资源文件带上新的 Etag 值并返回 200；

5. 如果服务器收到的请求没有 Etag 值，则将 If-Modified-Since 和被请求文件的最后修改时间做比对，一致则命中协商缓存，返回 304；不一致则返回新的 last-modified 和文件并返回 200；



## 4. 网站资源后面加上版本号？

   每次升级JS或CSS文件后，为了防止浏览器进行缓存，强制改变版本号，浏览器就会重新下载新的JS或CSS文件，以保证用户能够及时获得网站的最新更新。



## 5. 协商缓存和强缓存的区别？



## 6. 点击刷新按钮或者按 F5、按 Ctrl+F5 （强制刷新）、地址栏回车有什么区别？

 
