## 1. 什么是CDN

​	CDN 的全称叫 Content Delivery Network，中文名叫「内容分发网络」，它是解决由于长距离而网络访问速度慢的问题。

> 怎么做到的呢？

​	简单来说，CDN 将内容资源分发到位于多个地理位置机房中的服务器上，这样我们在访问内容资源的时候，不用访问源服务器。

​	而是直接访问离我们最近的 CDN 节点 ，这样一来就省去了长途跋涉的时间成本，从而实现了网络加速。

> CDN能加速什么类型的内容

**CDN 加速的是内容资源是静态资源**。

所谓的「静态资源」是指数据内容静态不变，任何时候来访问都是一样的，比如图片、音频。

与之相反的「动态资源」，是指数据内容是动态变化的，每次访问都不一样，比如用户信息等。

不过，动态资源如果也想被缓存加速，就要使用动态 CDN，其中一种方式就是将数据的逻辑计算放在 CDN 节点来做，这种方式就被称为边缘计算。

> CDN是怎么从源服务器获取资源的呢？

**CDN 加速的是内容资源是静态资源**。

所谓的「静态资源」是指数据内容静态不变，任何时候来访问都是一样的，比如图片、音频。

与之相反的「动态资源」，是指数据内容是动态变化的，每次访问都不一样，比如用户信息等。

不过，动态资源如果也想被缓存加速，就要使用动态 CDN，其中一种方式就是将数据的逻辑计算放在 CDN 节点来做，这种方式就被称为边缘计算。



## 2. 如何找到离用户最近的CDN节点？

找到离用户最近的CDN节点是由CDN的全局负载均衡器（GSLB）负责的。

**在没有CDN的情况下**，当我们访问域名时，DNS服务器最终回返回源服务器的地址。

比如，当我们在浏览器输入 www.xiaolin.com 域名后，在本地 host 文件找不到域名时，客户端就会访问本地 DNS 服务器。

![图片](https://gitee.com/ljcdzh/my_pic/raw/master/img/202203151627533.png)

这时候:

- 如果本地 DNS 服务器有缓存该网站的地址，则直接返回网站的地址；
- 如果没有就通过递归查询的方式，先请求根 DNS，根 DNS 返回顶级 DNS（.com）的地址；再请求 .com 顶级 DNS 得到 xiaolin.com 的域名服务器地址，再从 xiaolin.com 的域名服务器中查询到 www.xiaolin.com 对应的 IP 地址，然后返回这个 IP 地址，同时本地 DNS 缓存该 IP 地址，这样下一次的解析同一个域名就不需要做 DNS 的迭代查询了。

**在有CDN后**：

1. 会在ljc.com的这个DNS服务器上，设置一个CNAME别名，指向另外一个域名www.ljc.cdn.com，返回给本地DNS服务器。

2. 接着继续解析该域名，这个时候访问的就是ljc.cdn.com这台专用的DNS服务器，在这个服务器上，又会设置一个CNAME, 指向另一个域名，这次指向的就是CDN的GSLB。

3. 接着，本地 DNS 服务器去请求 CDN 的 GSLB 的域名，GSLB 就会为用户选择一台合适的 CDN 节点提供服务，选择的依据主要有以下几点：

   - 看用户的 IP 地址，查表得知地理位置，找相对最近的 CDN 节点；
   - 看用户所在的运营商网络，找相同网络的 CDN 节点；
   - 看用户请求 URL，判断哪一台服务器上有用户所请求的资源；
   - 查询 CDN 节点的负载情况，找负载较轻的节点；

   GSLB 会基于以上的条件进行综合分析后，找出一台最合适的 CDN 节点，并返回该 CDN 节点的 IP 地址给本地 DNS 服务器，然后本地 DNS 服务器缓存该 IP 地址，并将 IP 返回给客户端，客户端去访问这个 CDN 节点，下载资源。





